import{r as d,a as be,R as je}from"./vendor-b1791c80.js";import{a as fe}from"./api-b5ee139b.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const x of o.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&l(x)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();var se={exports:{}},$={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ye=d,ve=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),we=Object.prototype.hasOwnProperty,ke=ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ce={key:!0,ref:!0,__self:!0,__source:!0};function re(r,t,a){var l,i={},o=null,x=null;a!==void 0&&(o=""+a),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(x=t.ref);for(l in t)we.call(t,l)&&!Ce.hasOwnProperty(l)&&(i[l]=t[l]);if(r&&r.defaultProps)for(l in t=r.defaultProps,t)i[l]===void 0&&(i[l]=t[l]);return{$$typeof:ve,type:r,key:o,ref:x,props:i,_owner:ke.current}}$.Fragment=Ne;$.jsx=re;$.jsxs=re;se.exports=$;var e=se.exports,U={},W=be;U.createRoot=W.createRoot,U.hydrateRoot=W.hydrateRoot;var Se={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Te=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Me=(r,t)=>{const a=d.forwardRef(({color:l="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:x,children:v,...T},y)=>d.createElement("svg",{ref:y,...Se,width:i,height:i,stroke:l,strokeWidth:x?Number(o)*24/Number(i):o,className:`lucide lucide-${Te(r)}`,...T},[...t.map(([j,p])=>d.createElement(j,p)),...(Array.isArray(v)?v:[v])||[]]));return a.displayName=`${r}`,a};var f=Me;const ne=f("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),G=f("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),X=f("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Ee=f("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Pe=f("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Y=f("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Z=f("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),ee=f("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ae=f("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),ze=f("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Le=f("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Ae=f("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),V=f("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),ie=f("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),te=f("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),le=window.location.origin,S=fe.create({baseURL:le,timeout:3e4,headers:{"Content-Type":"application/json"}});S.interceptors.response.use(r=>r,r=>{throw console.error("API Error:",r),r.response?r.response.status>=500?new Error("Erreur serveur. Veuillez réessayer plus tard."):r:new Error("Problème de connexion réseau")});const Re={async getEvents(){try{return(await S.get("/api/events")).data}catch(r){throw console.error("Erreur lors de la récupération des événements:",r),r}}},Ie={async validatePromo(r,t){try{return(await S.post("/api/validate-promo",{code:r,nombreBillets:t})).data}catch(a){throw console.error("Erreur validation code promo:",a),a}}},J={async createTicket(r){try{return(await S.post("/api/tickets",r)).data}catch(t){throw console.error("Erreur création ticket:",t),t}},async validateTicket(r,t){try{return(await S.put(`/api/tickets/${r}/validate`,{action:t})).data}catch(a){throw console.error("Erreur validation ticket:",a),a}},async verifyTicket(r){try{return(await S.post("/api/tickets/verify",r)).data}catch(t){throw console.error("Erreur vérification ticket:",t),t}}},_e={async simulateMobileMoneyPayment(r){try{return(await S.post("/api/mobile-money/simulate",r)).data}catch(t){throw console.error("Erreur simulation Mobile Money:",t),t}},async handleMobileMoneyWebhook(r){try{return(await S.post("/api/webhook/mobile-money",r)).data}catch(t){throw console.error("Erreur webhook Mobile Money:",t),t}}},Oe={async getStats(){try{return(await S.get("/api/admin/stats")).data}catch(r){throw console.error("Erreur récupération stats:",r),r}}},Fe={async testConnection(){try{return{success:!0,data:(await S.get("/api/events")).data}}catch(r){return{success:!1,error:r.message}}},getBaseURL(){return le}},qe=({onBack:r,isOnline:t,apiWorking:a})=>{var D,A,m,R,u;const[l,i]=d.useState({totalTickets:{count:0},pendingTickets:{count:0},totalRevenue:{total:0},ticketsPending:[],ticketsRecent:[]}),[o,x]=d.useState(!0),[v,T]=d.useState(""),[y,j]=d.useState(""),[p,k]=d.useState(null),M=async()=>{x(!0),T("");try{if(t&&a){const s=await Oe.getStats();i(s)}else{const s=JSON.parse(localStorage.getItem("tickets")||"[]"),c=JSON.parse(localStorage.getItem("transactions")||"[]"),N=s.filter(C=>C.statut==="confirmed"),I=s.filter(C=>C.statut==="pending"),_=c.filter(C=>C.statut==="completed");i({totalTickets:{count:N.length},pendingTickets:{count:I.length},totalRevenue:{total:_.reduce((C,O)=>C+(O.montant||0),0)},ticketsPending:I.slice(-10),ticketsRecent:N.slice(-10).reverse()})}}catch(s){console.error("Erreur chargement stats:",s),T("Impossible de charger les statistiques")}finally{x(!1)}},z=async(s,c)=>{try{if(t&&a)await J.validateTicket(s,c);else{const _=JSON.parse(localStorage.getItem("tickets")||"[]").map(E=>E.id===s?{...E,statut:c==="approve"?"confirmed":"rejected",dateValidation:new Date().toISOString()}:E);localStorage.setItem("tickets",JSON.stringify(_));const O=JSON.parse(localStorage.getItem("transactions")||"[]").map(E=>E.ticketId===s?{...E,statut:c==="approve"?"completed":"failed"}:E);localStorage.setItem("transactions",JSON.stringify(O))}await M(),alert(`✅ Ticket ${c==="approve"?"approuvé":"rejeté"} avec succès`)}catch(N){console.error("Erreur validation ticket:",N),T(`Erreur lors de la validation: ${N.message}`)}},b=async()=>{if(!y.trim()){T("Veuillez entrer un ID ou QR code");return}k(null),T("");try{if(t&&a){const s=await J.verifyTicket({ticketId:y,qrCode:y});k(s)}else{const c=JSON.parse(localStorage.getItem("tickets")||"[]").find(N=>N.id===y||N.qrCode===y||N.codeUnique===y);c?c.statut==="confirmed"?k({valid:!0,ticket:{id:c.id,nombreBillets:c.nombreBillets,prixTotal:c.prixTotal,typePaiement:c.typePaiement},message:`Ticket valide - ${c.nombreBillets} personne(s) - Accès autorisé`}):k({valid:!1,ticket:c,message:`Ticket non confirmé - Statut: ${c.statut}`}):k({valid:!1,message:"Ticket introuvable"})}}catch(s){console.error("Erreur vérification ticket:",s),T(`Erreur vérification: ${s.message}`)}j("")};return d.useEffect(()=>{M()},[]),o?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"animate-spin mx-auto mb-4 text-blue-600",size:48}),e.jsx("p",{children:"Chargement du dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100 p-4",children:[(!t||!a)&&e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 p-2 text-center text-sm text-white ${t?"bg-orange-500":"bg-red-500"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t?e.jsx(ne,{size:16}):e.jsx(V,{size:16}),e.jsxs("span",{children:[t?"API non disponible":"Mode hors-ligne"," - Données locales uniquement"]})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto mt-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:t&&a?e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:"En ligne"})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{size:16,className:"text-orange-600"}),e.jsx("span",{className:"text-sm text-orange-600",children:"Hors-ligne"})]})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:M,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:[e.jsx(ee,{size:16}),e.jsx("span",{children:"Actualiser"})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Retour Client"})]})]})}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-600",children:v})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tickets confirmés"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:((D=l.totalTickets)==null?void 0:D.count)||0})]}),e.jsx(Ae,{className:"text-blue-600",size:32})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenus totaux"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[(((A=l.totalRevenue)==null?void 0:A.total)||0).toLocaleString()," F"]})]}),e.jsx(Le,{className:"text-green-600",size:32})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"En attente"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:((m=l.pendingTickets)==null?void 0:m.count)||0})]}),e.jsx(Pe,{className:"text-orange-600",size:32})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"🎫 Contrôle d'accès"}),e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsx("input",{type:"text",value:y,onChange:s=>j(s.target.value),placeholder:"Scanner ou saisir l'ID du ticket...",className:"flex-1 p-3 border border-gray-300 rounded-lg",onKeyPress:s=>s.key==="Enter"&&b()}),e.jsxs("button",{onClick:b,className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center space-x-2",children:[e.jsx(ae,{size:20}),e.jsx("span",{children:"Vérifier"})]})]}),p&&e.jsxs("div",{className:`p-4 rounded-lg border ${p.valid?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[p.valid?e.jsx(X,{className:"text-green-600",size:20}):e.jsx(te,{className:"text-red-600",size:20}),e.jsx("span",{className:`font-semibold ${p.valid?"text-green-600":"text-red-600"}`,children:p.message})]}),p.valid&&p.ticket&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["• ID: ",p.ticket.id]}),e.jsxs("p",{children:["• Personnes: ",p.ticket.nombreBillets]}),e.jsxs("p",{children:["• Montant:"," ",(R=p.ticket.prixTotal)==null?void 0:R.toLocaleString()," FCFA"]}),e.jsxs("p",{children:["• Paiement: ",p.ticket.typePaiement]})]})]})]}),((u=l.ticketsPending)==null?void 0:u.length)>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["⏳ Tickets en attente (",l.ticketsPending.length,")"]}),e.jsx("div",{className:"space-y-4",children:l.ticketsPending.map(s=>{var c;return e.jsx("div",{className:"border border-orange-200 rounded-lg p-4 bg-orange-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-mono text-sm text-gray-600",children:s.id}),e.jsxs("p",{className:"font-semibold",children:[s.nombre_billets||s.nombreBillets," ","billet(s) -"," ",(c=s.prix_total||s.prixTotal)==null?void 0:c.toLocaleString()," ","FCFA"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Paiement: ",s.type_paiement||s.typePaiement,s.code_promo&&` • Code: ${s.code_promo}`]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Créé:"," ",new Date(s.date_creation||s.dateCreation).toLocaleString("fr-FR")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>z(s.id,"approve"),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center space-x-1",children:[e.jsx(X,{size:16}),e.jsx("span",{children:"Approuver"})]}),e.jsxs("button",{onClick:()=>z(s.id,"reject"),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 flex items-center space-x-1",children:[e.jsx(te,{size:16}),e.jsx("span",{children:"Rejeter"})]})]})]})},s.id)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"✅ Tickets récents confirmés"}),!l.ticketsRecent||l.ticketsRecent.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun ticket confirmé"}):e.jsx("div",{className:"space-y-2",children:l.ticketsRecent.map(s=>{var c;return e.jsx("div",{className:"border border-green-200 rounded-lg p-3 bg-green-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm text-gray-600",children:s.id}),e.jsxs("p",{className:"text-sm",children:[s.nombre_billets||s.nombreBillets," ","billet(s) -"," ",(c=s.prix_total||s.prixTotal)==null?void 0:c.toLocaleString()," ","FCFA"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.date_validation||s.dateValidation).toLocaleString("fr-FR")})]})},s.id)})})]})]})]})},Ve=(r,t)=>{const[a,l]=d.useState(()=>{try{const o=localStorage.getItem(r);return o?JSON.parse(o):t}catch{return t}});return[a,o=>{l(o);try{localStorage.setItem(r,JSON.stringify(o))}catch(x){console.error("Erreur localStorage:",x)}}]},$e=()=>{const[r,t]=d.useState(navigator.onLine);return d.useEffect(()=>{const a=()=>t(!0),l=()=>t(!1);return window.addEventListener("online",a),window.addEventListener("offline",l),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",l)}},[]),r},P=({isOnline:r,apiWorking:t})=>r&&t?null:e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 p-2 text-center text-sm text-white ${r?"bg-orange-500":"bg-red-500"}`,children:r?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(ne,{size:16}),e.jsx("span",{children:"Problème de connexion API - Utilisation du cache local"})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(V,{size:16}),e.jsx("span",{children:"Mode hors-ligne - Fonctionnalités limitées"})]})});function De(){const[r,t]=d.useState("qr-scan"),[a,l]=d.useState(1),[i,o]=d.useState(""),[x,v]=d.useState(0),[T,y]=d.useState(""),[j,p]=d.useState(null),[k,M]=d.useState(!1),[z,b]=d.useState(""),[D,A]=d.useState([]),[m,R]=d.useState(null),u=$e(),[s,c]=d.useState(!0),[N,I]=Ve("tickets",[]),_={NOEL2024:{reduction:10,actif:!0},FAMILLE:{reduction:15,minBillets:4,actif:!0},EARLY:{reduction:20,actif:!0}};d.useEffect(()=>{O(),C()},[]);const C=async()=>{try{const n=await Fe.testConnection();c(n.success),n.success||console.warn("API non accessible, utilisation du cache local")}catch(n){c(!1),console.error("Test API failed:",n)}},O=async()=>{try{if(u&&s){const n=await Re.getEvents();A(n),R(n[0]||null),localStorage.setItem("cached_events",JSON.stringify(n))}else{const n=JSON.parse(localStorage.getItem("cached_events")||"[]");if(n.length>0)A(n),R(n[0]);else{const g={id:1,nom:"Village de Noël KIDS EVENTS",prix_unitaire:5e3,stock_restant:200,date_event:"2024-12-25"};A([g]),R(g)}}}catch(n){console.error("Erreur chargement événements:",n),b("Erreur lors du chargement des événements")}},E=async()=>{var n,g;if(!i.trim()){b("Veuillez entrer un code promo");return}M(!0),b("");try{if(u&&s){const h=await Ie.validatePromo(i.toUpperCase(),a);v(h.pourcentage),alert(`✅ Code appliqué ! Réduction de ${h.pourcentage}%`)}else{const h=_[i.toUpperCase()];if(h&&h.actif){if(h.minBillets&&a<h.minBillets){b(`Ce code nécessite minimum ${h.minBillets} billets`);return}v(h.reduction),alert(`✅ Code appliqué ! Réduction de ${h.reduction}%`)}else b("Code promo invalide"),o(""),v(0)}}catch(h){console.error("Erreur validation promo:",h),b(((g=(n=h.response)==null?void 0:n.data)==null?void 0:g.error)||"Erreur validation code promo"),o(""),v(0)}finally{M(!1)}},L=()=>m?(m.prix_unitaire||5e3)*a*(100-x)/100:0,F=async(n,g={})=>{var q,H;if(!m)throw new Error("Aucun événement sélectionné");const h={eventId:m.id,nombreBillets:a,typePaiement:n,codePromo:i||null,prixUnitaire:m.prix_unitaire||5e3,...g};try{if(u&&s){const w=await J.createTicket(h);return{id:w.ticketId,codeUnique:w.codeUnique,qrCode:w.qrCode,prixTotal:w.prixTotal,reduction:w.reduction,statut:w.statut,eventId:m.id,nombreBillets:a,typePaiement:n,codePromo:i,dateCreation:new Date().toISOString()}}else{const w={id:`OFFLINE_TICKET_${Date.now()}`,codeUnique:`${m.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,qrCode:`QR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,prixTotal:L(),reduction:x,statut:n==="mobile-money"?"confirmed":"pending",eventId:m.id,nombreBillets:a,typePaiement:n,codePromo:i,dateCreation:new Date().toISOString(),isOffline:!0},ge=[...N,w];return I(ge),w}}catch(w){throw console.error("Erreur génération ticket:",w),new Error(((H=(q=w.response)==null?void 0:q.data)==null?void 0:H.error)||"Erreur lors de la génération du ticket")}},B=async n=>{M(!0),b("");try{if(u&&s){const g={provider:n,montant:L(),numero:`${n==="MTN"?"70":n==="MOOV"?"96":"90"}123456`},h=await _e.simulateMobileMoneyPayment(g);if(h.success){const q=await F("mobile-money",{mobileMoneyProvider:n,transactionId:h.transactionId});p(q),t("ticket-generated")}else throw new Error(h.message||"Échec du paiement")}else{setTimeout(async()=>{try{const g=await F("mobile-money");p(g),t("ticket-generated")}catch(g){b(g.message)}finally{M(!1)}},2e3);return}}catch(g){console.error("Erreur paiement Mobile Money:",g),b(g.message||"Erreur lors du paiement")}finally{M(!1)}},Q=()=>{l(1),o(""),v(0),p(null),b(""),y("")},K=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-green-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[e.jsx("div",{className:"bg-red-500 text-white rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{size:32})}),e.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:"Village de Noël"}),e.jsx("h2",{className:"text-lg text-gray-600 mb-6",children:"KIDS EVENTS"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 mb-6",children:[e.jsx(ae,{size:48,className:"mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Scannez le QR code pour acheter vos billets"})]}),e.jsxs("div",{className:`inline-flex items-center space-x-2 px-3 py-1 rounded-full text-xs mb-4 ${u&&s?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:[u&&s?e.jsx(ie,{size:12}):e.jsx(V,{size:12}),e.jsx("span",{children:u&&s?"En ligne":"Mode hors-ligne"})]}),e.jsx("button",{onClick:()=>t("ticket-selection"),className:"w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors mb-4",children:"Acheter des billets"}),e.jsx("button",{onClick:()=>t("admin"),className:"w-full bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600 transition-colors",children:"Accès Admin"})]})})]}),oe=()=>{var n,g;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-center",children:"Sélection des billets"}),m&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:m.nom}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Prix: ",(n=m.prix_unitaire)==null?void 0:n.toLocaleString()," FCFA"]}),m.stock_restant&&e.jsxs("p",{className:"text-xs text-blue-600",children:["Stock disponible: ",m.stock_restant]})]}),z&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:z})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nombre de billets"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{onClick:()=>{l(Math.max(1,a-1)),b("")},className:"w-12 h-12 bg-red-500 text-white rounded-full flex items-center justify-center text-xl font-bold",children:"-"}),e.jsx("span",{className:"text-2xl font-bold w-8 text-center",children:a}),e.jsx("button",{onClick:()=>{l(a+1),b("")},className:"w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center text-xl font-bold",children:"+"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Code de réduction (optionnel)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:i,onChange:h=>{o(h.target.value.toUpperCase()),b("")},placeholder:"NOEL2024",className:"flex-1 p-3 border border-gray-300 rounded-lg",disabled:k}),e.jsx("button",{onClick:E,disabled:k||!i.trim(),className:"px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed",children:k?"...":"Valider"})]}),x>0&&e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["✅ Réduction de ",x,"% appliquée"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Prix unitaire:"}),e.jsxs("span",{children:[((g=m==null?void 0:m.prix_unitaire)==null?void 0:g.toLocaleString())||"5,000"," FCFA"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Quantité:"}),e.jsx("span",{children:a})]}),x>0&&e.jsxs("div",{className:"flex justify-between mb-2 text-green-600",children:[e.jsxs("span",{children:["Réduction (",x,"%):"]}),e.jsxs("span",{children:["-",(((m==null?void 0:m.prix_unitaire)||5e3)*a*x/100).toLocaleString()," ","FCFA"]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[L().toLocaleString()," FCFA"]})]})]}),e.jsx("button",{onClick:()=>t("payment-selection"),className:"w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors",children:"Continuer vers le paiement"})]})})]})},ce=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-green-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-center",children:"Mode de paiement"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>{y("cash"),t("cash-payment")},className:"w-full p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 flex items-center space-x-4",children:[e.jsx(G,{className:"text-green-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Espèces (Cash)"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Paiement à la caisse"})]})]}),e.jsxs("button",{onClick:()=>{y("card"),t("card-payment")},className:"w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 flex items-center space-x-4",children:[e.jsx(Y,{className:"text-blue-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Carte bancaire"}),e.jsx("div",{className:"text-sm text-gray-500",children:"TPE à l'accueil"})]})]}),e.jsxs("button",{onClick:()=>{y("mobile-money"),t("mobile-money-selection")},className:"w-full p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 flex items-center space-x-4",children:[e.jsx(ze,{className:"text-orange-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Mobile Money"}),e.jsx("div",{className:"text-sm text-gray-500",children:"MTN, Moov, Togocom"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium",children:"Récapitulatif:"}),e.jsxs("div",{className:"text-lg font-bold",children:[L().toLocaleString()," FCFA"]})]})]})})]}),de=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-orange-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-center",children:"Mobile Money"}),z&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:z})}),k?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{children:"Traitement du paiement en cours..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Veuillez patienter"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onClick:()=>B("MTN"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-yellow-500 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center text-white font-bold",children:"MTN"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"MTN Mobile Money"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Composez *133#"})]})]})}),e.jsx("div",{onClick:()=>B("MOOV"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:"MOOV"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Moov Money"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Composez *555#"})]})]})}),e.jsx("div",{onClick:()=>B("TOGOCOM"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:"TCEL"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Togocom"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Composez *890#"})]})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Montant à payer:"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[L().toLocaleString()," FCFA"]})]}),!u&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ Mode hors-ligne: Le ticket sera généré localement et devra être synchronisé plus tard."})})]})})]}),me=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[e.jsx(G,{size:48,className:"mx-auto text-green-600 mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Paiement en espèces"}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg mb-6",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Montant à payer:"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[L().toLocaleString()," FCFA"]})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Présentez-vous à la caisse avec le montant exact. Votre ticket sera généré après validation du paiement par notre équipe."}),e.jsx("button",{onClick:async()=>{try{const n=await F("cash");p(n),t("ticket-pending")}catch(n){b(n.message)}},className:"w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600",children:"Confirmer - Aller à la caisse"})]})})]}),xe=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[e.jsx(Y,{size:48,className:"mx-auto text-blue-600 mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Paiement par carte"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Montant à payer:"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[L().toLocaleString()," FCFA"]})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Dirigez-vous vers le TPE à l'accueil pour effectuer votre paiement par carte bancaire. Votre ticket sera généré après validation."}),e.jsx("button",{onClick:async()=>{try{const n=await F("card");p(n),t("ticket-pending")}catch(n){b(n.message)}},className:"w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600",children:"Confirmer - Aller au TPE"})]})})]}),he=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ee,{size:32})}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-green-600",children:"Paiement confirmé !"}),j&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"border-2 border-gray-300 rounded-lg p-4 mb-4",children:[e.jsx(Z,{size:64,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 font-mono break-all",children:j.qrCode})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ID Ticket:"}),e.jsx("span",{className:"font-mono text-xs",children:j.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Nombre de billets:"}),e.jsx("span",{children:j.nombreBillets})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Prix total:"}),e.jsxs("span",{className:"font-semibold",children:[j.prixTotal.toLocaleString()," FCFA"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mode de paiement:"}),e.jsx("span",{className:"capitalize",children:j.typePaiement.replace("-"," ")})]}),j.isOffline&&e.jsx("div",{className:"text-orange-600 text-xs mt-2",children:"⚠️ Ticket créé hors-ligne - Synchronisation requise"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Présentez ce QR code à l'entrée de l'événement"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{t("qr-scan"),Q()},className:"w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600",children:"Nouveau ticket"}),e.jsx("button",{onClick:()=>t("admin"),className:"w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600",children:"Accès Admin"})]})]})})]}),ue=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-orange-50 to-red-50 p-4",children:[e.jsx(P,{isOnline:u,apiWorking:s}),e.jsx("div",{className:"max-w-md mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[e.jsx("div",{className:"bg-orange-500 text-white rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-white border-t-transparent"})}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-orange-600",children:"Paiement en attente"}),j&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Votre ticket:"}),e.jsx("div",{className:"font-mono text-sm bg-white p-2 rounded break-all",children:j.id}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[j.nombreBillets," billet(s) -"," ",j.prixTotal.toLocaleString()," FCFA"]}),j.isOffline&&e.jsx("div",{className:"text-orange-600 text-xs mt-2",children:"⚠️ Ticket créé hors-ligne"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Votre demande de ticket est enregistrée. Effectuez votre paiement et attendez la validation de notre équipe."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>t("admin"),className:"w-full bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-orange-600",children:"Vérifier le statut (Admin)"}),e.jsx("button",{onClick:()=>{t("qr-scan"),Q()},className:"w-full bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600",children:"Nouveau ticket"})]})]})})]}),pe=()=>{switch(r){case"qr-scan":return e.jsx(K,{});case"ticket-selection":return e.jsx(oe,{});case"payment-selection":return e.jsx(ce,{});case"cash-payment":return e.jsx(me,{});case"card-payment":return e.jsx(xe,{});case"mobile-money-selection":return e.jsx(de,{});case"ticket-generated":return e.jsx(he,{});case"ticket-pending":return e.jsx(ue,{});case"admin":return e.jsx(qe,{onBack:()=>t("qr-scan"),isOnline:u,apiWorking:s});default:return e.jsx(K,{})}};return e.jsx("div",{className:"font-sans",children:pe()})}U.createRoot(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(De,{})}));
//# sourceMappingURL=index-9cbee4fc.js.map
